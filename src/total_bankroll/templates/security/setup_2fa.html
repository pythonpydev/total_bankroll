{% extends "core/base.html" %}
{% from "partials/_macros.html" import page_header %}

{% block content %}
{{ page_header('Set Up Two-Factor Authentication', 'Add an extra layer of security to your account.') }}

<section class="page-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 text-center">
                <p>Scan the QR code below with your authenticator app (like Google Authenticator, Authy, or 1Password).</p>
                <img src="data:image/png;base64,{{ qr_code_data }}" alt="QR Code for 2FA" class="img-fluid mb-3" style="max-width: 250px;">

                <p>If you can't scan the code, you can manually enter this secret key:</p>
                <p><code class="fs-5">{{ secret }}</code></p>

                <hr class="my-4">

                <h4 class="mb-3">Verify Your Device</h4>
                <p>Enter the 6-digit code from your authenticator app to complete the setup.</p>

                <form method="POST" action="{{ url_for('settings.setup_2fa') }}" class="d-inline-block">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <div class="mb-3">
                        <label for="token" class="form-label visually-hidden">Verification Code</label>
                        <input type="text" id="token" name="token" class="form-control form-control-lg text-center" required pattern="\d{6}" title="Enter a 6-digit code" maxlength="6" autofocus>
                    </div>
                    <button type="submit" class="btn btn-primary">Verify and Enable</button>
                    <a href="{{ url_for('settings.settings_page') }}" class="btn btn-secondary">Cancel</a>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}