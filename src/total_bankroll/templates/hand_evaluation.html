{% extends "base.html" %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/plo_styles.css') }}">
{% endblock %}

{% block content %}
  <div class="center-content">
    <div class="data-display">
      <h2>Hand Evaluation</h2>
      <div class="card-display-row">
        <p><strong>Hero's Hand:</strong></p>
        <span id="heroHand"></span>
      </div>
      <div class="card-display-row">
        <p><strong>Board Cards:</strong></p>
        <span id="boardCardsHero"></span>
      </div>
      <p><strong>Hero's Hand Evaluation:</strong> {{ form_data.hero_eval }}</p>
      <p><strong>Opponent's Hand Evaluation:</strong> {{ form_data.opp_eval }}</p>
      <p><strong>Hero's Hand Strength:</strong> {{ 'Stronger' if form_data.hero_eval < form_data.opp_eval else 'Weaker' }}</p>
      <p><strong>Opponent's Hand Strength:</strong> {{ 'Stronger' if form_data.opp_eval < form_data.hero_eval else 'Weaker' }}</p>
      <div class="card-display-row">
        <p><strong>Hero's Best Hand:</strong></p>
        <span id="heroBestHand"></span>
      </div>
      <p><strong>Hero's Hand Name:</strong> {{ form_data.hero_hand_name }}</p>
      <p>Outs to a pair: <span style="color: red;">{% if 8 < form_data.hero_current_rank_class %}{{ form_data.hero_outs_breakdown.pair }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to two pair: <span style="color: red;">{% if 7 < form_data.hero_current_rank_class %}{{ form_data.hero_outs_breakdown.two_pair }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to three of a kind: <span style="color: red;">{% if 6 < form_data.hero_current_rank_class %}{{ form_data.hero_outs_breakdown.trips }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to a straight: <span style="color: red;">{% if 5 < form_data.hero_current_rank_class %}{{ form_data.hero_outs_breakdown.straight }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to a flush: <span style="color: red;">{% if 4 < form_data.hero_current_rank_class %}{{ form_data.hero_outs_breakdown.flush }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to a full house: <span style="color: red;">{% if 3 < form_data.hero_current_rank_class %}{{ form_data.hero_outs_breakdown.full_house }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to four of a kind: <span style="color: red;">{% if 2 < form_data.hero_current_rank_class %}{{ form_data.hero_outs_breakdown.quads }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to a straight flush: <span style="color: red;">{% if 1 < form_data.hero_current_rank_class %}{{ form_data.hero_outs_breakdown.straight_flush }}{% else %}N/A{% endif %}</span></p>
      
      <div class="card-display-row">
        <p><strong>Opponent's Hand:</strong></p>
        <span id="opponentHand"></span>
      </div>
      <div class="card-display-row">
        <p><strong>Board Cards:</strong></p>
        <span id="boardCardsOpponent"></span>
      </div>
      <div class="card-display-row">
        <p><strong>Opponent's Best Hand:</strong></p>
        <span id="opponentBestHand"></span>
      </div>
      <p><strong>Opponent's Hand Name:</strong> {{ form_data.opp_hand_name }}</p>
      <p>Outs to a pair: <span style="color: red;">{% if 8 < form_data.opp_current_rank_class %}{{ form_data.opp_outs_breakdown.pair }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to two pair: <span style="color: red;">{% if 7 < form_data.opp_current_rank_class %}{{ form_data.opp_outs_breakdown.two_pair }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to three of a kind: <span style="color: red;">{% if 6 < form_data.opp_current_rank_class %}{{ form_data.opp_outs_breakdown.trips }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to a straight: <span style="color: red;">{% if 5 < form_data.opp_current_rank_class %}{{ form_data.opp_outs_breakdown.straight }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to a flush: <span style="color: red;">{% if 4 < form_data.opp_current_rank_class %}{{ form_data.opp_outs_breakdown.flush }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to a full house: <span style="color: red;">{% if 3 < form_data.opp_current_rank_class %}{{ form_data.opp_outs_breakdown.full_house }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to four of a kind: <span style="color: red;">{% if 2 < form_data.opp_current_rank_class %}{{ form_data.opp_outs_breakdown.quads }}{% else %}N/A{% endif %}</span></p>
      <p>Outs to a straight flush: <span style="color: red;">{% if 1 < form_data.opp_current_rank_class %}{{ form_data.opp_outs_breakdown.straight_flush }}{% else %}N/A{% endif %}</span></p>
    </div>

    <div class="d-grid gap-2 mt-3">
      <a href="/hand_details" class="btn btn-outline-primary">Back to Hand Details</a>
      <a href="{{ url_for('hand_eval.plo_hand_form') }}" class="btn btn-outline-secondary">Setup New Hand</a>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const rankOrder = ['A', 'K', 'Q', 'J', 'T', '9', '8', '7', '6', '5', '4', '3', '2'];
      const suitOrder = ['s', 'h', 'd', 'c'];

      function sortCards(cards) {
        return cards.sort((a, b) => {
          const rankA = rankOrder.indexOf(a[0]);
          const rankB = rankOrder.indexOf(b[0]);
          if (rankA !== rankB) {
            return rankA - rankB;
          }
          const suitA = suitOrder.indexOf(a[1]);
          const suitB = suitOrder.indexOf(b[1]);
          return suitA - suitB;
        });
      }

      function displayCards(hand, elementId) {
        const container = document.getElementById(elementId);
        hand.forEach(card => {
          const img = document.createElement('img');
          img.src = `{{ url_for('static', filename='images/cards/') }}${card}.png`;
          img.alt = card;
          img.classList.add('card-image');
          container.appendChild(img);
        });
      }

      const heroBestHand = sortCards({{ form_data.hero_best_hand|tojson }});
      const oppBestHand = sortCards({{ form_data.opp_best_hand|tojson }});

      displayCards(heroBestHand, 'heroBestHand');
      displayCards(oppBestHand, 'opponentBestHand');

      // Add these lines to display hero's hand, board cards, and opponent's hand
      const heroHand = sortCards({{ form_data.hero_hand|tojson }});
      const boardCards = sortCards({{ form_data.board|tojson }});
      const opponentHand = sortCards({{ form_data.opponent_hand|tojson }});

      displayCards(heroHand, 'heroHand');
      displayCards(boardCards, 'boardCardsHero');
      displayCards(opponentHand, 'opponentHand');
      displayCards(boardCards, 'boardCardsOpponent');
    });
  </script>

{% endblock %}