{% extends "core/base.html" %}
{% from "partials/_macros.html" import page_header %}

{% block content %}
{{ page_header('Poker Sites Value Over Time (Scatter Chart)', 'Scatter chart of site balances in USD over time.') }}

<section class="page-section" id="charts-content">
  <div class="container px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5">
      <div class="col-lg-12">
        <a href="{{ url_for('charts.charts_page') }}" class="btn btn-secondary mb-4"><i class="bi-arrow-left"></i> Back to Chart Selection</a>
        <canvas id="pokerSitesChart"></canvas>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    fetch('/charts/poker_sites_historical_data')
      .then(response => response.json())
      .then(data => {
        const ctx = document.getElementById('pokerSitesChart').getContext('2d');
        const chartData = {
          datasets: data.datasets.map(dataset => ({
            label: dataset.label,
            data: dataset.data.map((amount, index) => ({
              x: data.labels[index],
              y: amount
            }))
          }))
        };

        const chartOptions = {
          plugins: {
            title: {
              display: true,
              text: 'Poker Sites Value Over Time (Scatter Chart)',
              font: { size: 18 }
            }
          },
          scales: {
            x: { type: 'time', time: { unit: 'day' }, title: { display: true, text: 'Date' } },
            y: { beginAtZero: true, title: { display: true, text: 'Amount (USD)' } }
          }
        };

        createChart(ctx, 'scatter', chartData, chartOptions);
      })
      .catch(error => console.error('Error fetching poker sites data:', error));
  });
</script>
{% endblock %}
