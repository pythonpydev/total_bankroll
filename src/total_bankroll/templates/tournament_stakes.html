{% extends "base.html" %}

{% block content %}
<section class="page-section bg-primary" id="tournament_stakes_intro">
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
            <div class="col-lg-8 text-center">
                <h2 class="text-white mt-0">Tournament Stakes</h2>
                <hr class="divider divider-light" />
                <p class="text-white-75 mb-4">This page will provide recommendations for tournament stakes based on your bankroll.</p>
            </div>
        </div>
    </div>
</section>

<section class="page-section" id="tournament_stakes_content">
    <div class="container px-4 px-lg-5 text-center">
        <form method="GET" action="{{ url_for('tools.tournament_stakes_page') }}">
            <input type="hidden" name="site_filter" value="{{ site_filter }}">
            <div class="row justify-content-center align-items-end g-3 mb-5">
                <div class="col-sm-6 col-lg-2">
                    <label for="game_type" class="form-label fw-bold">Game Type</label>
                    <select class="form-select" id="game_type" name="game_type">
                        <option value="na" {% if game_type == 'na' %}selected{% endif %}>Not Applicable (NA)</option>
                        <option value="limit_holdem" {% if game_type == 'limit_holdem' %}selected{% endif %}>Limit Holdâ€™Em</option>
                        <option value="nlhe" {% if game_type == 'nlhe' %}selected{% endif %}>NLHE</option>
                        <option value="plo" {% if game_type == 'plo' %}selected{% endif %}>PLO</option>
                    </select>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <label for="skill_level" class="form-label fw-bold">Skill Level</label>
                    <select class="form-select" id="skill_level" name="skill_level">
                        <option value="na" {% if skill_level == 'na' %}selected{% endif %}>Not Applicable (NA)</option>
                        <option value="soft" {% if skill_level == 'soft' %}selected{% endif %}>Soft Games</option>
                        <option value="tough" {% if skill_level == 'tough' %}selected{% endif %}>Tough Games</option>
                    </select>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <label for="risk_tolerance" class="form-label fw-bold">Risk Tolerance</label>
                    <select class="form-select" id="risk_tolerance" name="risk_tolerance">
                        <option value="na" {% if risk_tolerance == 'na' %}selected{% endif %}>Not Applicable (NA)</option>
                        <option value="conservative" {% if risk_tolerance == 'conservative' %}selected{% endif %}>Conservative</option>
                        <option value="aggressive" {% if risk_tolerance == 'aggressive' %}selected{% endif %}>Aggressive</option>
                    </select>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <label for="game_environment" class="form-label fw-bold">Game Environment</label>
                    <select class="form-select" id="game_environment" name="game_environment">
                        <option value="na" {% if game_environment == 'na' %}selected{% endif %}>Not Applicable (NA)</option>
                        <option value="live" {% if game_environment == 'live' %}selected{% endif %}>Live Poker</option>
                        <option value="online" {% if game_environment == 'online' %}selected{% endif %}>Online Poker</option>
                    </select>
                </div>
                <div class="col-sm-12 col-lg-2">
                    <button type="submit" class="btn btn-primary w-100">Update</button>
                </div>
            </div>
        </form>
        <h2 class="mt-0">Tournament Stakes Recommendations</h2>
        <hr class="divider" />
        <p class="lead fw-bold text-dark p-3 bg-light border rounded shadow-sm mb-4">Your current total bankroll is: <span class="bi-bank"> $ </span> {{ "%.2f" | format(total_bankroll) }}</p>
        {% if tournament_bankroll_recommendation and tournament_bankroll_recommendation != "0 to 0 buy-ins" %}
        <div class="alert alert-success mt-4" role="alert">
            <h4 class="alert-heading">Recommended Bankroll Size</h4>
            <p>Based on your selections, a bankroll of <strong>{{ tournament_bankroll_recommendation }}</strong> is recommended for your chosen tournament type.</p>
            <hr>
            <p class="mb-0">This suggests an average tournament buy-in of <strong>${{ "%.2f" | format(recommended_buy_in) }}</strong>.</p>
        </div>
        {% endif %}

        {% if recommended_tournament_stake != "N/A" %}
        <div class="text-center">
            <h3 class="mt-5">Recommended Tournament Stakes: {{ recommended_tournament_stake }}</h3>
            <p class="bg-success text-white fw-bold p-3 rounded mb-4">{{ stake_explanation }}</p>
            {% if move_down_message %}<p class="bg-primary text-white fw-bold p-3 rounded mb-4">{{ move_down_message }}</p>{% endif %}
            {% if next_stake_message %}<p class="bg-danger text-white fw-bold p-3 rounded mb-4">{{ next_stake_message }}</p>{% endif %}
        </div>
        {% elif stake_explanation %}
            <p class="text-muted mb-4 text-center">{{ stake_explanation }}</p>
        {% endif %}

        <div class="text-start mt-5">
            <form method="GET" action="{{ url_for('tools.tournament_stakes_page') }}" class="row g-3 align-items-end mb-4 justify-content-center">
                <input type="hidden" name="game_type" value="{{ game_type }}">
                <input type="hidden" name="skill_level" value="{{ skill_level }}">
                <input type="hidden" name="risk_tolerance" value="{{ risk_tolerance }}">
                <input type="hidden" name="game_environment" value="{{ game_environment }}">
                <div class="col-auto">
                    <label for="site_filter" class="form-label fw-bold">Select poker site</label>
                    <select class="form-select" id="site_filter" name="site_filter">
                        <option value="all" {% if site_filter == 'all' %}selected{% endif %}>All</option>
                        <option value="pokerstars" {% if site_filter == 'pokerstars' %}selected{% endif %}>PokerStars</option>
                        <option value="gg" {% if site_filter == 'gg' %}selected{% endif %}>GG Poker</option>
                        <option value="partypoker" {% if site_filter == 'partypoker' %}selected{% endif %}>PartyPoker</option>
                    </select>
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">Go!</button>
                </div>
            </form>
            
            {% if site_filter == 'all' or site_filter == 'pokerstars' %}
                {% with site_data=tournament_buy_ins.pokerstars %}
                    {% include '_tournament_table.html' %}
                {% endwith %}
            {% endif %}

            {% if site_filter == 'all' or site_filter == 'gg' %}
                {% with site_data=tournament_buy_ins.gg %}
                    {% include '_tournament_table.html' %}
                {% endwith %}
            {% endif %}

            {% if site_filter == 'all' or site_filter == 'partypoker' %}
                {% with site_data=tournament_buy_ins.partypoker %}
                    {% include '_tournament_table.html' %}
                {% endwith %}
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}